# 前端环境搭建

## 技术选型

  * vue3 + vite
    * [参考链接](https://vue3js.cn/docs/zh/guide/installation.html)
  * vite
    * [参考链接](https://cn.vitejs.dev/guide/)
    * [vite config](https://cn.vitejs.dev/config/)
  * typescript
  * elementui
    * 参考链接：

## 前提

安装nodejs

## 搭建步骤

1. 使用 Vite 快速构建 Vue 项目
    ```sh
    npm init @vitejs/app # 按照提示创建所需的项目
    cd <project-name>
    npm install
    ```
2. 在浏览器上验证
    ```sh
    npm run dev 
    ```
    * ```npm run dev``` 报错 ```Error: esbuild: Failed to install correctly```
        * [解决方案](https://blog.csdn.net/m0_37682004/article/details/115001613)
            * 运行```node node_modules/esbuild/install.js```
3. 更根据需要修改vite配置文件
4. 使用vite mockjs插件
  [参考](https://github.com/anncwb/vite-plugin-mock)
5. 添加vue router
  [参考](https://next.router.vuejs.org/zh/installation.html)
6. 添加vuex
  [参考](https://next.vuex.vuejs.org/installation.html)
7. 添加element3

8. 设置vite环境变量
9. 添加网络请求模块axios
10. 配置Eslint
  * `npm i -D @vue/eslint-config-prettier babel-eslint eslint eslint-plugin-prettier eslint-plugin-vue prettier`
  * 配置lint规则，项目根目录创建.eslintrc.js

  ```js
  module.exports = {
    root: true,
    env: {
      node: true,
    },
    extends: [
      'plugin:vue/base',
      'plugin:vue/vue3-essential',
      'plugin:vue/vue3-strongly-recommended',
      'plugin:vue/vue3-recommended',
      'eslint:recommended',
      '@vue/prettier',
    ],
    parserOptions: {
      parser: 'babel-eslint',
    },
    rules: {
      'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
      'no-debugger': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
      'prettier/prettier': [
        'warn',
        {
          // singleQuote: none,
          // semi: false,
          trailingComma: 'es5',
        },
      ],
    },
  };


  ```

  * 项目根目录创建prettier.config.js，修改prettier的默认格式化规则

  ```js
  module.exports = {
    printWidth: 80, // 每行代码长度（默认80）
    tabWidth: 2, // 每个tab相当于多少个空格（默认2）
    useTabs: false, // 是否使用tab进行缩进（默认false）
    singleQuote: true, // 使用单引号（默认false）
    semi: true, // 声明结尾使用分号(默认true)
    trailingComma: 'es5', // 多行使用拖尾逗号（默认none）
    bracketSpacing: true, // 对象字面量的大括号间使用空格（默认true）
    jsxBracketSameLine: false, // 多行JSX中的>放置在最后一行的结尾，而不是另起一行（默认false）
    arrowParens: 'avoid', // 只有一个参数的箭头函数的参数是否带圆括号（默认avoid）
  };
  ```

  * package.json添加lint检查

  ```json
    "scripts": {
      "lint": "eslint \"src/**/*.{js,vue}\""
    },
  ```

  [eslint参考](https://eslint.vuejs.org/user-guide/)
  [vetur参考](https://vuejs.github.io/vetur/guide/setup.html)
  vscode安装eslint,vetur插件，根据需要配置editorconfig

  * 运行`npm run lint`查看错误
  * 快捷修复：`F1` -> `ESlint:Fix all auto-fixabl Problems`

11. 添加单体测试
  * `npm i -D jest vue-jest babel-jest @babel/preset-env @vue/test-utils`
  * 配置babel.config.js

  ```js
  module.exports = {
    presets: [
      [
        "@babel/preset-env", { 
          targets: { 
            node: "current" 
          } 
        }
      ]
    ],
  };
  ```

  * 配置jest.config.js

  ```js
  module.exports = {
    testEnvironment: "jsdom",
    transform: {
      "^.+\\.vue$": "vue-jest",
      "^.+\\js$": "babel-jest",
    },
    moduleFileExtensions: ["vue", "js", "json", "jsx", "ts", "tsx", "node"],
    testMatch: ["**/tests/unit/**/*.spec.js"],
    moduleNameMapper: {
      "^main(.*)$": "<rootDir>/src$1",
    },
  };
  ```

  * package.json添加单体测试

  ```json
    "scripts": {
      "test:unit": "jest --runInBand"
    },
  ```

  * 运行`npm run test:unit`

    * 如果报错`Cannot find module 'vue-template-compiler'`
      安装 "vue-jest": "^5.0.0-alpha.8"
      `npm i -D vue-jest@^5.0.0-alpha.8`

12. 代码提交前检测(可选)
    * `npm i lint-staged yorkie -D`
    * package.json添加
    ```json
    "gitHooks": {
      "pre-commit": "lint-staged",
      "pre-push": "npm run test"
    },
    "lint-staged": {
      "*.{js,vue}": "eslint"
    },
    ```

<!-- 4. 添加单体测试
    * [链接](https://testing-library.com/docs/vue-testing-library/intro)
    ```sh
    npm install --save-dev jest @types/jest ts-jest @jest/types
    npm install --save-dev vue-jest ts-node
    # npm install --save-dev @testing-library/vue@next
    npm install @vue/test-utils@next --save-dev
    ``` -->

## 问题

* ```npm run dev``` 报错 ```Error: esbuild: Failed to install correctly```
    * [解决方案](https://blog.csdn.net/m0_37682004/article/details/115001613)
        * 运行```node node_modules/esbuild/install.js```